CREATE DATABASE FlowerSyte
USE FlowerSyte

CREATE TABLE Tags
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(20) NOT NULL,
)

CREATE TABLE CATEGORY
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(20) NOT NULL,
)

CREATE TABLE AdditionalInfoTypes
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(20) NOT NULL,
)

CREATE TABLE Users
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(30) NOT NULL,
Surname NVARCHAR(30) NOT NULL,
Email NVARCHAR(100) NOT NULL,
Image NVARCHAR(40),
PasswordHash NVARCHAR(30) NOT NULL,
Address NVARCHAR(100) NOT NULL,
)

CREATE TABLE Orders
(
Id INT PRIMARY KEY IDENTITY,
UserId INT FOREIGN KEY REFERENCES Users(Id),
CreatedAt DATETIME2,
DeliviedAt DATETIME2,
Status TINYINT,
PaymentStatus TINYINT,
TotalAmount DECIMAL(18,2),
Address NVARCHAR(100),
Fullname NVARCHAR(100) NOT NULL,
Email NVARCHAR(100) NOT NULL,
)

CREATE TABLE Products
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(20) NOT NULL,
Price DECIMAL(18,2),
CatogoryId INT FOREIGN KEY REFERENCES CATEGORY(Id),
DiscountAmount DECIMAL(18,2),
IsNew BIT,
Count INT,
[Desc] NVARCHAR(1500),
Code NVARCHAR(10),
CostPrice DECIMAL(18,2)
)

CREATE TABLE ProductTags
(
Id INT PRIMARY KEY IDENTITY,
ProductId INT FOREIGN KEY REFERENCES Products(Id),
TagId INT FOREIGN KEY REFERENCES Tags(Id),
)

CREATE TABLE Reviews
(
Id INT PRIMARY KEY IDENTITY,
Name NVARCHAR(20) NOT NULL,
Email NVARCHAR(100) NOT NULL,
CreatedAt DATETIME2,
ProductId INT FOREIGN KEY REFERENCES Products(Id),
UserId INT FOREIGN KEY REFERENCES Users(Id),
Text NVARCHAR(350) NOT NULL
)

CREATE TABLE ProductImage
(
Id INT PRIMARY KEY IDENTITY,
ProductId INT FOREIGN KEY REFERENCES Products(Id),
Image NVARCHAR(30),
)

CREATE TABLE AdditionalInfos
(
Id INT PRIMARY KEY IDENTITY,
ProductId INT FOREIGN KEY REFERENCES Products(Id),
AdditionalInfoTypesId INT FOREIGN KEY REFERENCES AdditionalInfoTypes(Id),
Value NVARCHAR(300),
)

CREATE TABLE Orderitems
(
Id INT PRIMARY KEY IDENTITY,
ProductId INT FOREIGN KEY REFERENCES Products(Id),
OrderId INT FOREIGN KEY REFERENCES Orders(Id),
Count INT,
Price INT NOT NULL,
DiscountAmount DECIMAL(18,2),
CostPrice DECIMAL(18,2)
)

/* datalar el ile daxil edilib.*/

SELECT *FROM Products


SELECT *FROM Orders AS O
JOIN Orderitems AS OI ON O.Id=OI.OrderId


SELECT *FROM Users
WHERE (SELECT COUNT(Id) FROM Orders WHERE UserId=Users.Id)=0

CREATE VIEW V_GetInfo
AS
SELECT U.Id,U.Name,
(SELECT COUNT(Id) FROM Orders AS O WHERE O.UserId=U.Id) AS 'TotalOrderCount',
(SELECT SUM(TotalAmount) FROM Orders AS O WHERE O.UserId=U.Id) AS 'TotalOrderAmount ',
 FROM Users AS U
JOIN Orders AS O ON U.Id=O.UserId


CREATE PROCEDURE USP_CREATE_NEW_USER
@Id INT,
@Name NVARCHAR(30),
@Surname NVARCHAR(30),
@Email NVARCHAR(100),
@Address NVARCHAR(100),
AS
INSERT INTO Users (Name,Surname,Email,Address)
VALUES('@Name','@Surname','@Email','@Address')
